<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <link rel="icon" type="image/png" sizes="512x512" href="/cmr512.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/cmr192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/cmr180.png">
  <title>Connect — CMR</title>

  <style>
    :root{
      --accent:#2b6cb0;
      --muted:#6b7280;
      --card-bg:#ffffff;
      --page-bg:#f3f4f6;
      --radius:12px;
      --max-width:900px;
      --pad:20px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }

    html,body{ margin:0; padding:0; background:var(--page-bg); color:#0f172a; -webkit-font-smoothing:antialiased; }
    .wrap{ width:100%; max-width:var(--max-width); margin:28px auto; padding:var(--pad); box-sizing:border-box; }
    .card{ background:linear-gradient(180deg,#fff,#fbfbfb); border-radius:var(--radius); padding:22px; box-shadow:0 8px 30px rgba(15,23,42,0.06); border:1px solid rgba(15,23,42,0.04); }
    .header{ display:flex; gap:14px; align-items:center; margin-bottom:12px; }
    .logo{ width:70px; height:70px; border-radius:10px; background:#ffffff; display:flex; align-items:center; justify-content:center; overflow:hidden; flex:0 0 64px; }
    .logo img{ width:100%; height:100%; object-fit:contain; display:block; }
    .title-block{ display:flex; flex-direction:column; gap:4px; }
    h1{ margin:0; font-size:22px; font-weight:800; color:#0f172a; }
    .subtitle{ margin:0; color:var(--muted); font-size:14px; }

    form { margin-top:14px; display:grid; gap:12px; }
    .row { display:flex; gap:12px; }
    .col { flex:1; display:flex; flex-direction:column; gap:6px; }
    label { font-weight:700; font-size:13px; color:#0f172a; }
    input[type="text"], input[type="tel"], input[type="email"], textarea, select {
      padding:10px 12px; border-radius:10px; border:1px solid rgba(15,23,42,0.06); background:#fff; font-size:14px; color:#0f172a;
      box-sizing:border-box;
    }
    textarea { min-height:120px; resize:vertical; }
    .small-muted{ font-size:13px; color:var(--muted); }

    .group { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .checkbox { display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px; background:#fff; border:1px solid rgba(15,23,42,0.04); cursor:pointer; }
    .checkbox input { margin:0; }

    .actions { display:flex; gap:12px; align-items:center; margin-top:6px; }
    .btn { background:var(--accent); color:#fff; padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:800; text-decoration:none; display:inline-flex; align-items:center; gap:8px; }
    .btn-ghost { background:#fff; border:1px solid rgba(15,23,42,0.06); color:#0f172a; padding:10px 12px; border-radius:10px; cursor:pointer; }

    .field-error { color:#b91c1c; font-size:13px; display:none; margin-top:6px; }

    .thankyou {
      display:none;
      margin-top:12px;
      padding:14px;
      border-radius:10px;
      background: linear-gradient(180deg, rgba(43,108,176,0.08), rgba(43,108,176,0.04));
      border:1px solid rgba(43,108,176,0.12);
      color:#0f172a;
      font-weight:700;
    }

    .lang-switcher { position:fixed; top:12px; right:12px; display:flex; gap:8px; z-index:9999; }
    .lang-btn { padding:8px 10px; border-radius:8px; border:1px solid rgba(15,23,42,0.06); background:#fff; cursor:pointer; font-weight:700; }

    @media (max-width:640px){
      .row { flex-direction:column; }
      .logo{ width:56px; height:56px; }
    }
  </style>
</head>
<body>
  <div class="lang-switcher" id="langSwitcherConnect" aria-hidden="false"></div>

  <div class="wrap">
    <div class="card" role="main" aria-labelledby="connectHeading">
      <div class="header">
        <div class="logo" aria-hidden="false">
          <!-- Replace with your PNG logo file path -->
          <img src="logo.png" alt="CMR logo" id="connectLogo">
        </div>
        <div class="title-block">
          <h1 id="connectHeading">Connect</h1>
          <p class="subtitle" id="connectIntro">Tell us about yourself and how you'd like to get involved.</p>
        </div>
      </div>

      <form id="connectForm" name="connect" method="POST" data-netlify="true" netlify-honeypot="bot-field" novalidate>
        <input type="hidden" name="form-name" value="connect" />

        <div class="row">
          <div class="col">
            <label for="first" id="labelFirst">First name</label>
            <input id="first" name="first" type="text" required aria-required="true" />
            <div class="field-error" id="first-error" aria-hidden="true"></div>
          </div>

          <div class="col">
            <label for="last" id="labelLast">Last name</label>
            <input id="last" name="last" type="text" required aria-required="true" />
            <div class="field-error" id="last-error" aria-hidden="true"></div>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="phone" id="labelPhone">Phone</label>
            <input id="phone" name="phone" type="tel" required aria-required="true" />
            <div class="field-error" id="phone-error" aria-hidden="true"></div>
          </div>

          <div class="col">
            <label for="email" id="labelEmail">Email (optional)</label>
            <input id="email" name="email" type="email" />
            <div class="field-error" id="email-error" aria-hidden="true"></div>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="address" id="labelAddress">Address (optional)</label>
            <input id="address" name="address" type="text" />
          </div>

          <div class="col">
            <label for="status" id="labelStatus">Status</label>
            <select id="status" name="status" aria-describedby="statusHelp">
              <option value="first_visit">First visit</option>
              <option value="second_visit">Second visit</option>
              <option value="regular">Regular attendee</option>
              <option value="member">Member</option>
            </select>
            <div id="statusHelp" class="small-muted">Choose the option that best describes you.</div>
          </div>
        </div>

        <div>
          <label id="labelInterest">I'd like to learn</label>
          <div class="group" role="group" aria-labelledby="labelInterest">
            <label class="checkbox"><input type="checkbox" name="interest" value="baptism"> Baptism</label>
            <label class="checkbox"><input type="checkbox" name="interest" value="serve"> Serving</label>
            <label class="checkbox"><input type="checkbox" name="interest" value="learn"> Learn about CMR</label>
            <label class="checkbox"><input type="checkbox" name="interest" value="follow"> Talk about following Jesus</label>
            <label class="checkbox"><input type="checkbox" name="interest" value="other"> Giving</label>
          </div>
        </div>

        <div>
          <label for="prayer" id="labelPrayer">Prayer request</label>
          <textarea id="prayer" name="prayer" placeholder="Share your request here"></textarea>
        </div>

        <div class="actions">
          <button type="submit" class="btn" id="submitBtn">Submit</button>
          <button type="reset" class="btn-ghost" id="resetBtn">Reset</button>
        </div>

        <div class="thankyou" id="thankyou" role="status" aria-live="polite">
          Thank you — we received your submission and will get back to you soon.
        </div>
      </form>
    </div>
  </div>

  <script>
    // Translations (English + French)
    const T = {
      en: {
        connectHeading: "Connect",
        connectIntro: "Tell us about yourself and how you'd like to get involved.",
        labelFirst: "First name",
        labelLast: "Last name",
        labelPhone: "Phone",
        labelEmail: "Email (optional)",
        labelAddress: "Address (optional)",
        labelStatus: "Status",
        statusHelp: "Choose the option that best describes you.",
        statusOptions: { first_visit: "First visit", second_visit: "Second visit", regular: "Regular attendee", member: "Member" },
        labelInterest: "I'd like to learn",
        interestOptions: { baptism: "Baptism", serve: "Serving", learn: "Learn about CMR", follow: "Talk about following Jesus", other: "Giving" },
        labelPrayer: "Prayer request (optional)",
        submitBtn: "Submit",
        resetBtn: "Reset",
        thankYou: "Thank you — we received your submission and will get back to you soon.",
        validation: {
          required: "This field is required.",
          phoneInvalid: "Enter a valid phone number.",
          emailInvalid: "Enter a valid email address."
        }
      },
      fr: {
        connectHeading: "Se connecter",
        connectIntro: "Parlez-nous de vous et comment vous souhaitez vous impliquer.",
        labelFirst: "Prénom",
        labelLast: "Nom",
        labelPhone: "Téléphone",
        labelEmail: "E-mail (optionnel)",
        labelAddress: "Adresse (optionnel)",
        labelStatus: "Statut",
        statusHelp: "Choisissez l'option qui vous décrit le mieux.",
        statusOptions: { first_visit: "Première visite", second_visit: "Deuxième visite", regular: "Participant régulier", member: "Membre" },
        labelInterest: "Je suis intéressé par",
        interestOptions: { baptism: "Baptême", serve: "Servir", learn: "En savoir plus sur CMR", follow: "Parler de suivre Jésus", other: "Donner" },
        labelPrayer: "Demande de prière (optionnel)",
        submitBtn: "Soumettre",
        resetBtn: "Réinitialiser",
        thankYou: "Merci — nous avons reçu votre message et nous vous contacterons bientôt.",
        validation: {
          required: "Ce champ est requis.",
          phoneInvalid: "Entrez un numéro de téléphone valide.",
          emailInvalid: "Entrez une adresse e-mail valide."
        }
      }
    };

    function getSavedLang(){ return localStorage.getItem('cmr_lang') || 'en'; }
    function setSavedLang(lang){ localStorage.setItem('cmr_lang', lang); applyTranslations(); }

    // Build language switcher
    function buildLangSwitcher(){
      const container = document.getElementById('langSwitcherConnect');
      if(!container) return;
      container.innerHTML = '';
      const enBtn = document.createElement('button'); enBtn.className='lang-btn'; enBtn.textContent='EN'; enBtn.onclick = ()=> setSavedLang('en');
      const frBtn = document.createElement('button'); frBtn.className='lang-btn'; frBtn.textContent='FR'; frBtn.onclick = ()=> setSavedLang('fr');
      container.appendChild(enBtn); container.appendChild(frBtn);
    }

    function applyTranslations(){
      const lang = getSavedLang();
      const t = T[lang] || T.en;
      document.getElementById('connectHeading').textContent = t.connectHeading;
      document.getElementById('connectIntro').textContent = t.connectIntro;
      document.getElementById('labelFirst').textContent = t.labelFirst;
      document.getElementById('labelLast').textContent = t.labelLast;
      document.getElementById('labelPhone').textContent = t.labelPhone;
      document.getElementById('labelEmail').textContent = t.labelEmail;
      document.getElementById('labelAddress').textContent = t.labelAddress;
      document.getElementById('labelStatus').textContent = t.labelStatus;
      document.getElementById('statusHelp').textContent = t.statusHelp;
      // status options
      const sel = document.getElementById('status');
      if(sel){
        sel.innerHTML = '';
        for(const key of ['first_visit','second_visit','regular','member']){
          const o = document.createElement('option');
          o.value = key;
          o.textContent = t.statusOptions[key];
          sel.appendChild(o);
        }
      }
      document.getElementById('labelInterest').textContent = t.labelInterest;
      // interest labels
      const interestLabels = document.querySelectorAll('.group .checkbox');
      const interestKeys = ['baptism','serve','learn','follow','other'];
      interestLabels.forEach((lbl, idx) => {
        const key = interestKeys[idx];
        const input = lbl.querySelector('input');
        if(input) input.value = key;
        // update visible text (keep checkbox input inside label)
        lbl.childNodes.forEach(node => {
          if(node.nodeType === Node.TEXT_NODE) node.remove();
        });
        lbl.appendChild(document.createTextNode(' ' + t.interestOptions[key]));
      });
      document.getElementById('labelPrayer').textContent = t.labelPrayer;
      document.getElementById('submitBtn').textContent = t.submitBtn;
      document.getElementById('resetBtn').textContent = t.resetBtn;
      document.getElementById('thankyou').textContent = t.thankYou;
    }

    // Validation helpers
    function showError(el, message){
      const err = document.getElementById(el.id + '-error');
      if(err){ err.textContent = message; err.style.display = 'block'; err.setAttribute('aria-hidden','false'); el.classList.add('input-invalid'); }
    }
    function clearError(el){
      const err = document.getElementById(el.id + '-error');
      if(err){ err.textContent = ''; err.style.display = 'none'; err.setAttribute('aria-hidden','true'); el.classList.remove('input-invalid'); }
    }

    function validateField(input){
      const lang = getSavedLang();
      const v = T[lang].validation;
      if(!input) return true;
      const val = (input.value || '').trim();
      if(input.required && val === ''){
        showError(input, v.required);
        return false;
      }
      if(input.type === 'tel' && val !== ''){
        const phonePattern = /^[0-9+\-\s().]{7,20}$/;
        if(!phonePattern.test(val)){ showError(input, v.phoneInvalid); return false; }
      }
      if(input.type === 'email' && val !== ''){
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if(!emailPattern.test(val)){ showError(input, v.emailInvalid); return false; }
      }
      clearError(input);
      return true;
    }

    // Submit handler: show inline thank you and attempt to POST to Netlify endpoint (graceful)
    document.addEventListener('DOMContentLoaded', function(){
      buildLangSwitcher();
      applyTranslations();

      const form = document.getElementById('connectForm');
      if(!form) return;

      const first = document.getElementById('first');
      const last = document.getElementById('last');
      const phone = document.getElementById('phone');
      const email = document.getElementById('email');

      [first,last,phone,email].forEach(f => { if(!f) return; f.addEventListener('input', ()=> validateField(f)); f.addEventListener('blur', ()=> validateField(f)); });

      form.addEventListener('submit', async function(e){
        e.preventDefault();
        // validate required fields
        let ok = true;
        [first,last,phone].forEach(f => { if(f) ok = validateField(f) && ok; });
        if(!ok){
          const firstInvalid = form.querySelector('.input-invalid');
          if(firstInvalid) firstInvalid.focus();
          return;
        }

        // collect form data
        const fd = new FormData(form);
        // collect interests (checkboxes)
        const interests = Array.from(form.querySelectorAll('input[name="interest"]:checked')).map(i => i.value);
        fd.delete('interest'); // remove single entries if any
        interests.forEach(i => fd.append('interest', i));

        // show thank you message immediately
        const thank = document.getElementById('thankyou');
        thank.style.display = 'block';
        thank.setAttribute('aria-hidden','false');

        // try to POST to Netlify (best-effort). If it fails, we still keep the thank-you visible.
        try {
          await fetch('/', { method: 'POST', body: fd, headers: { 'Accept': 'application/json' } });
        } catch (err) {
          // ignore network errors — user still sees thank you
          console.warn('Netlify submit failed (this is non-blocking):', err);
        }

        // Optionally clear the form after submit
        form.reset();
        // hide validation errors if any
        [first,last,phone,email].forEach(f => { if(f) clearError(f); });

        // keep thank you visible for a while then hide (optional)
        setTimeout(()=>{ thank.style.display = 'none'; thank.setAttribute('aria-hidden','true'); }, 8000);
      });
    });
  </script>
</body>
</html>
