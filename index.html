
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>CMR Hub</title>

  <!-- Base styles -->
  <style>
    :root{
      --accent:#2b6cb0;
      --muted:#6b7280;
      --card-bg:#ffffff;
      --page-bg:#f3f4f6;
      --radius:10px;
      --gap:18px;
      --max-width:1100px;
      --container-padding:20px;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Reset and robust centering for foldables and all devices */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      -webkit-text-size-adjust: 100%;
      -webkit-font-smoothing: antialiased;
      background: var(--page-bg);
      color: #111827;
      min-height: 100vh;
    }
    *, *::before, *::after { box-sizing: inherit; }

    /* Centering container: margin auto is robust across devices */
    .wrap {
      width: 100%;
      max-width: var(--max-width);
      margin-left: auto;
      margin-right: auto;
      padding-left: calc(var(--container-padding) + env(safe-area-inset-left));
      padding-right: calc(var(--container-padding) + env(safe-area-inset-right));
      padding-top: var(--container-padding);
      padding-bottom: var(--container-padding);
      box-sizing: border-box;
      position: relative;
    }

    /* Fallback for browsers without env() support */
    @supports not (padding: env(safe-area-inset-left)) {
      .wrap {
        padding-left: var(--container-padding);
        padding-right: var(--container-padding);
      }
    }

    /* Layout: left column + right column stacked */
    .layout-fixed{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
      align-items:start;
      width:100%;
      margin:0 auto;
      box-sizing: border-box;
    }
    .left-col{ display:flex; flex-direction:column; gap:18px; }
    .right-col{ display:flex; flex-direction:column; gap:16px; }

    @media (max-width:980px){
      .layout-fixed{ grid-template-columns: 1fr; }
      .right-col{ order:2; }
      .left-col{ order:1; }
    }

    .card{ background:var(--card-bg); border-radius:var(--radius); padding:20px; box-shadow:0 6px 18px rgba(15,23,42,0.06); border:1px solid rgba(15,23,42,0.04); }
    .hub-header{ display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .hub-logo{ width:32px; height:32px; border-radius:8px; background:#111827; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; font-size:16px; }
    .hub-title{ font-size:20px; font-weight:700; margin:0; }
    .hub-subtitle{ font-size:13px; color:var(--muted); margin:0; }

    .hub-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    @media(max-width:640px){ .hub-grid{ grid-template-columns:repeat(2,1fr); } }

    .hub-button{ background:#f8fafc; border-radius:10px; padding:14px; display:flex; gap:12px; align-items:center; cursor:pointer; border:1px solid transparent; transition:all .12s ease; text-decoration:none; color:inherit; }
    .hub-button:hover{ transform:translateY(-2px); box-shadow:0 6px 18px rgba(15,23,42,0.04); }
    .hub-icon{ width:44px; height:44px; border-radius:8px; background:linear-gradient(135deg,var(--accent),#4c9bd6); display:flex; align-items:center; justify-content:center; color:white; }
    .hub-icon svg{ width:22px; height:22px; stroke-width:2.2; }
    .hub-label{ font-weight:600; font-size:15px; }
    .hub-sub{ font-size:13px; color:var(--muted); }

    .announcement-list{ display:flex; flex-direction:column; gap:16px; }
    .announcement{ display:flex; flex-direction:column; gap:12px; border-radius:10px; padding:14px; background:#f9fafb; border:1px solid #e5e7eb; }
    .announcement .thumb{ width:100%; height:160px; border-radius:8px; object-fit:cover; background:#e6eef9; }
    .meta-row{ display:flex; justify-content:space-between; gap:10px; align-items:center; font-size:13px; color:var(--muted); }
    .announce-title{ font-size:18px; font-weight:700; margin:0; }
    .announce-desc{ font-size:14px; color:#111827; line-height:1.45; }
    .small-muted{ font-size:13px; color:var(--muted); }
    .cta-row{ display:flex; gap:10px; margin-top:8px; }
    .btn{ padding:10px 12px; border-radius:8px; border:1px solid transparent; cursor:pointer; font-weight:600; font-size:14px; text-decoration:none; display:inline-flex; align-items:center; gap:6px; }
    .btn-primary{ background:var(--accent); color:white; }

    /* Serve section: glass cards and centered rows */
    .serve-card { background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.45)); backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,0.18); box-shadow: 0 8px 30px rgba(15,23,42,0.06); padding:18px; border-radius:12px; }

    .serve-header { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .serve-title { margin:0; font-size:18px; font-weight:700; }
    .serve-sub { margin:4px 0 0 0; color:var(--muted); font-size:13px; }

    .serve-grid {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:14px;
      justify-items:center;
      align-items:start;
    }

    .serve-item {
      width:100%;
      max-width:320px;
      background: linear-gradient(180deg, rgba(255,255,255,0.55), rgba(255,255,255,0.35));
      border-radius:12px;
      padding:14px;
      box-shadow: 0 6px 18px rgba(15,23,42,0.04);
      border:1px solid rgba(15,23,42,0.04);
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .serve-item h3 { margin:0; font-size:15px; font-weight:700; }
    .serve-item ul { margin:0; padding-left:18px; color:#111827; }
    .serve-item li { margin:6px 0; font-size:14px; }

    .serve-badge { width:44px; height:44px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center; color:#fff; font-weight:700; background:linear-gradient(135deg,var(--accent),#4c9bd6); }

    .serve-actions { display:flex; gap:8px; }
    .btn-ghost { background:#fff; border:1px solid rgba(15,23,42,0.06); color:#111827; padding:8px 12px; border-radius:8px; cursor:pointer; }

    /* Hidden state */
    #serveCard[aria-hidden="true"], #serveCard.hidden { display:none !important; }

    /* Announcement accent when data-accent is set */
    #announcementsCard[data-accent="true"] { border-left: 4px solid var(--accent); padding-left: 12px; }
    #announcementsCard2[data-accent="true"] { border-left: 4px solid var(--accent); padding-left: 12px; }

    /* small responsive tweaks */
    @media (max-width:420px){
      .wrap{ padding-left: calc(12px + env(safe-area-inset-left)); padding-right: calc(12px + env(safe-area-inset-right)); }
      .card{ padding:14px; }
    }

    /* Optional: quick rule to hide the serve section (comment out to show) */
    /* To hide the serve section site-wide, uncomment the next line:
       #serveCard { display: none !important; } */
  </style>

  <!-- Brand stylesheet (after base styles) -->
  <link rel="stylesheet" href="cmr-brand.css">

  <!-- Feather icons -->
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
  <div class="wrap" id="pageWrap">
    <div class="layout-fixed" id="mainLayout">
      <!-- LEFT COLUMN: Hub + How to Serve -->
      <div class="left-col">
        <!-- CMR HUB CARD -->
        <div class="card" id="hubCard" aria-label="CMR Hub">
          <div class="hub-header">
            <div class="hub-logo" id="logoText">CMR</div>
            <div>
              <h1 class="hub-title" id="hubTitle">CMR Hub</h1>
              <p class="hub-subtitle" id="hubSubtitle">One place for everything happening at CMR.</p>
            </div>
          </div>

          <div class="hub-grid" role="navigation" aria-label="Main actions">
            <a class="hub-button" href="https://example.com/give" id="giveBtn" title="Give" data-app-href="paypal://send?recipient=YOUR_PAYPAL_ID">
              <div class="hub-icon"><i data-feather="heart"></i></div>
              <div><div class="hub-label" id="giveLabel">Give</div><div class="hub-sub" id="giveSub">Support online</div></div>
            </a>

            <a class="hub-button" href="https://www.youtube.com/watch?v=VIDEO_ID" id="sermonsBtn" title="Sermons" data-app-href="youtube://watch?v=VIDEO_ID" data-android-intent="intent://www.youtube.com/watch?v=VIDEO_ID#Intent;package=com.google.android.youtube;scheme=https;end">
              <div class="hub-icon"><i data-feather="video"></i></div>
              <div><div class="hub-label" id="sermonsLabel">Sermons</div><div class="hub-sub" id="sermonsSub">Watch on YouTube</div></div>
            </a>

            <a class="hub-button" href="listen.html" id="listenBtn" title="Listen">
              <div class="hub-icon"><i data-feather="headphones"></i></div>
              <div><div class="hub-label" id="listenLabel">Listen</div><div class="hub-sub" id="listenSub">Audio highlights</div></div>
            </a>

            <a class="hub-button" href="connect.html" id="connectBtn" title="Connect">
              <div class="hub-icon"><i data-feather="user-plus"></i></div>
              <div><div class="hub-label" id="connectLabel">Connect</div><div class="hub-sub" id="connectSub">Fill out the form</div></div>
            </a>

            <a class="hub-button" href="https://example.com" id="visitBtn" title="Visit Website">
              <div class="hub-icon"><i data-feather="globe"></i></div>
              <div><div class="hub-label" id="visitLabel">Visit Website</div><div class="hub-sub" id="visitSub">More info online</div></div>
            </a>

            <a class="hub-button" href="https://linktr.ee" id="followBtn" title="Follow Us">
              <div class="hub-icon"><i data-feather="share-2"></i></div>
              <div><div class="hub-label" id="followLabel">Follow Us</div><div class="hub-sub" id="followSub">Social links</div></div>
            </a>
          </div>
        </div>

        <!-- HOW TO SERVE (updated glass cards) -->
        <section id="serveCard" class="card serve-card" aria-labelledby="serveHeading" data-enabled="true">
          <div class="serve-header">
            <div style="flex:1;">
              <h2 id="serveHeading" class="serve-title">How to Serve</h2>
              <p class="serve-sub small-muted">Join a team that fits your gifts</p>
            </div>
            <div class="serve-actions" aria-hidden="true">
              <button class="btn" onclick="setServeVisible(false)" title="Hide section">Hide</button>
              <button class="btn-ghost" onclick="setServeVisible(true)" title="Show section">Show</button>
            </div>
          </div>

          <div id="serveGrid" class="serve-grid" role="list" aria-live="polite"></div>

          <div class="serve-cta" style="margin-top:12px;">
            <a class="btn" href="connect.html#serve">Join a Team</a>
            <a class="btn-ghost" href="connect.html#learn">Learn More</a>
          </div>
        </section>
      </div>

      <!-- RIGHT COLUMN: Announcements -->
      <aside class="right-col" aria-label="Right column">
        <div class="card" id="announcementsCard" aria-live="polite" data-accent="true">
          <h3 id="announcementsTitle" style="margin:0 0 12px 0;">Announcements</h3>
          <div id="announcementContainer"></div>
        </div>

        <div class="card" id="announcementsCard2" aria-live="polite" style="display:none;">
          <h3 style="margin:0 0 12px 0;">More Announcements</h3>
          <div id="announcementContainer2"></div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // ---------- CONFIG ----------
    const SHOW_ANNOUNCEMENTS = null; // true | false | null (auto)
    const SHOW_SECOND_ANNOUNCEMENT = null; // true | false | null (auto)
    const ANNOUNCEMENT_JSON_URL = '/announcement.json';

    // translations
    const translations = {
      en: { announcements: "Announcements", more_announcements: "More Announcements", learn_more: "Learn more", no_announcements: "No current announcements" },
      fr: { announcements: "Annonces", more_announcements: "Plus d'annonces", learn_more: "En savoir plus", no_announcements: "Aucune annonce en cours" }
    };
    function getSavedLang(){ return localStorage.getItem('cmr_lang') || 'en'; }

    // language switcher
    const ENABLE_LANGUAGE_SWITCHER = true;
    function createLangSwitcher(){
      if(!ENABLE_LANGUAGE_SWITCHER) return;
      const wrap = document.createElement('div');
      wrap.className = 'lang-switcher';
      const enBtn = document.createElement('button'); enBtn.className = 'lang-btn'; enBtn.textContent = 'EN'; enBtn.onclick = () => { localStorage.setItem('cmr_lang','en'); applyTranslations(); renderAnnouncementsFromData(lastAnnouncementData); renderServeGridFromData(lastServeData); };
      const frBtn = document.createElement('button'); frBtn.className = 'lang-btn'; frBtn.textContent = 'FR'; frBtn.onclick = () => { localStorage.setItem('cmr_lang','fr'); applyTranslations(); renderAnnouncementsFromData(lastAnnouncementData); renderServeGridFromData(lastServeData); };
      wrap.appendChild(enBtn); wrap.appendChild(frBtn); document.body.appendChild(wrap);
    }
    function applyTranslations(){
      const lang = getSavedLang();
      const t = translations[lang] || translations.en;
      const primaryTitle = document.getElementById('announcementsTitle');
      if(primaryTitle) primaryTitle.textContent = t.announcements;
      const secH = document.querySelector('#announcementsCard2 h3');
      if(secH) secH.textContent = t.more_announcements;
    }

    // ---------- ANNOUNCEMENT LOGIC ----------
    let lastAnnouncementData = null;
    function isExpired(expireDateStr){ if(!expireDateStr) return false; const now = new Date(); const expire = new Date(expireDateStr + 'T23:59:59'); return now > expire; }

    function renderSingleAnnouncement(containerEl, data, lang){
      if(!containerEl) return;
      containerEl.innerHTML = '';
      const wrapper = document.createElement('div'); wrapper.className = 'announcement';
      const meta = document.createElement('div'); meta.className = 'meta-row';
      const dateSpan = document.createElement('div'); dateSpan.className = 'small-muted'; dateSpan.textContent = data.date || new Date().toLocaleDateString();
      const typeSpan = document.createElement('div'); typeSpan.className = 'small-muted'; typeSpan.textContent = (data.type || 'announcement').toUpperCase();
      meta.appendChild(dateSpan); meta.appendChild(typeSpan); wrapper.appendChild(meta);

      if(data.thumbnail){
        const img = document.createElement('img'); img.className = 'thumb'; img.src = data.thumbnail; img.alt = data.title || 'Announcement image';
        wrapper.appendChild(img);
      }

      const title = document.createElement('h3'); title.className = 'announce-title';
      const titleText = (lang === 'fr' && data.title_fr) ? data.title_fr : data.title || '';
      title.textContent = titleText;
      wrapper.appendChild(title);

      const descText = (lang === 'fr' && data.description_fr) ? data.description_fr : data.description || '';
      if(descText){
        const desc = document.createElement('div'); desc.className = 'announce-desc'; desc.textContent = descText; wrapper.appendChild(desc);
      }

      if(data.extra && (data.extra.location || data.extra.time)){
        const info = document.createElement('div'); info.className = 'small-muted';
        info.textContent = `${data.extra.location ? data.extra.location + ' â€¢ ' : ''}${data.extra.time ? data.extra.time : ''}`.trim();
        wrapper.appendChild(info);
      }

      const ctaRow = document.createElement('div'); ctaRow.className = 'cta-row';
      const learn = document.createElement('a'); learn.className = 'btn btn-primary'; learn.href = data.learnMoreUrl || '#'; learn.target = '_blank'; learn.rel = 'noopener';
      learn.textContent = translations[lang].learn_more;
      ctaRow.appendChild(learn); wrapper.appendChild(ctaRow);

      containerEl.appendChild(wrapper);
    }

    // Helper to mark secondary card with blue accent if it contains a thumbnail
    function markSecondaryAccentIfThumbnail(){
      const secContainer = document.getElementById('announcementContainer2');
      const secCard = document.getElementById('announcementsCard2');
      if(!secContainer || !secCard) return;
      const img = secContainer.querySelector('img.thumb');
      if(img && img.src && img.src.trim() !== ''){
        secCard.setAttribute('data-accent', 'true');
      } else {
        secCard.removeAttribute('data-accent');
      }
    }

    function renderAnnouncementsFromData(rawData){
      lastAnnouncementData = rawData;
      const lang = getSavedLang();
      let showAnnouncementsFlag = undefined;
      let items = [];

      if(!rawData){
        items = [];
      } else if(Array.isArray(rawData)){
        items = rawData;
      } else if(typeof rawData === 'object'){
        if(Array.isArray(rawData.items)) items = rawData.items;
        if(rawData.showAnnouncements === false) showAnnouncementsFlag = false;
        if(rawData.showAnnouncements === true) showAnnouncementsFlag = true;
      }

      const active = (items || []).filter(a => a.enabled !== false && !isExpired(a.expireDate));

      const primaryCard = document.getElementById('announcementsCard');
      const secondaryCard = document.getElementById('announcementsCard2');

      if (showAnnouncementsFlag === false) {
        if(primaryCard) primaryCard.style.display = 'none';
        if(secondaryCard) secondaryCard.style.display = 'none';
        return;
      }

      if (SHOW_ANNOUNCEMENTS === false) {
        if(primaryCard) primaryCard.style.display = 'none';
      } else if (SHOW_ANNOUNCEMENTS === true) {
        if(primaryCard) primaryCard.style.display = '';
      } else {
        if(primaryCard) primaryCard.style.display = (active.length > 0) ? '' : 'none';
      }

      if (secondaryCard) {
        if (SHOW_SECOND_ANNOUNCEMENT === true) {
          secondaryCard.style.display = '';
        } else if (SHOW_SECOND_ANNOUNCEMENT === false) {
          secondaryCard.style.display = 'none';
        } else {
          secondaryCard.style.display = (active.length >= 2) ? '' : 'none';
        }
      }

      const primaryContainer = document.getElementById('announcementContainer');
      const secondaryContainer = document.getElementById('announcementContainer2');
      if(primaryContainer) primaryContainer.innerHTML = '';
      if(secondaryContainer) secondaryContainer.innerHTML = '';

      if(active[0] && primaryContainer) renderSingleAnnouncement(primaryContainer, active[0], lang);
      if(active[1] && secondaryContainer) {
        renderSingleAnnouncement(secondaryContainer, active[1], lang);
        // mark accent if thumbnail exists
        markSecondaryAccentIfThumbnail();
      } else {
        if (secondaryCard) secondaryCard.removeAttribute('data-accent');
      }

      if(active.length > 2 && primaryContainer){
        const more = document.createElement('div'); more.className = 'small-muted'; more.style.marginTop = '8px';
        more.textContent = `${active.length - 2} more announcement(s) available.`;
        primaryContainer.appendChild(more);
      }

      if(active.length === 0 && primaryCard && primaryCard.style.display !== 'none' && primaryContainer){
        const placeholder = document.createElement('div'); placeholder.className = 'announcement-placeholder';
        placeholder.textContent = translations[lang].no_announcements;
        primaryContainer.appendChild(placeholder);
      }
    }

    async function loadAndRenderAnnouncements(){
      try{
        const res = await fetch(ANNOUNCEMENT_JSON_URL, { cache: 'no-store' });
        if(!res.ok) throw new Error('Announcement not found');
        const data = await res.json();
        renderAnnouncementsFromData(data);
      }catch(e){
        console.warn('Failed to load announcement.json', e);
        renderAnnouncementsFromData(null);
      }
    }

    // ---------- APP LINK HELPER ----------
    function tryOpenAppThenFallback(anchor, event){
      if (event.metaKey || event.ctrlKey || event.shiftKey || event.button === 1) return;
      const appHref = anchor.getAttribute('data-app-href');
      const androidIntent = anchor.getAttribute('data-android-intent');
      const webHref = anchor.href;
      const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      if(!isMobile || !appHref) return;
      event.preventDefault();
      if (/Android/i.test(navigator.userAgent) && androidIntent) {
        window.location = androidIntent;
        return;
      }
      let didHide = false;
      function onVisibilityChange() { didHide = document.hidden; }
      document.addEventListener('visibilitychange', onVisibilityChange);
      const timeout = setTimeout(() => {
        document.removeEventListener('visibilitychange', onVisibilityChange);
        if (!didHide) window.location = webHref;
      }, 1200);
      try { window.location = appHref; } catch (e) { clearTimeout(timeout); document.removeEventListener('visibilitychange', onVisibilityChange); window.location = webHref; }
    }

    function wireAppLinks(){
      const anchors = document.querySelectorAll('.hub-button[data-app-href]');
      anchors.forEach(a => { a.addEventListener('click', function(e){ tryOpenAppThenFallback(a, e); }); });
    }

    // ---------- SERVE GRID DATA & RENDER ----------
    // Inline fallback data; you can move this to public/serve-data.json and call loadServeDataFrom()
    const SERVE_DATA = [
      { id: 'production', title: 'Production Team', roles: ['Sound Engineer','Video Switcher','Camera Operator','Slide Operator'], enabled: true, badgeText: 'PROD' },
      { id: 'worship', title: 'Worship Team', roles: ['Lead Singer','Guitar','Bass','Drums','Keys'], enabled: true, badgeText: 'WOR' },
      { id: 'kids', title: 'Kids Ministry', roles: ['Classroom Helper','Check-In Support','Story Leader'], enabled: true, badgeText: 'KIDS' },
      { id: 'guest', title: 'Guest Experience', roles: ['Usher','Greeter','Welcome Team'], enabled: true, badgeText: 'GUEST' },
      { id: 'creative', title: 'Creative & Media', roles: ['Photography','Social Media','Graphic Support'], enabled: true, badgeText: 'CRE' },
      { id: 'admin', title: 'Administration', roles: ['Office Support','Prayer Follow-up','Hospitality'], enabled: true, badgeText: 'ADMIN' }
    ];
    let lastServeData = null;

    function renderServeGrid(data) {
      lastServeData = data || SERVE_DATA;
      const grid = document.getElementById('serveGrid');
      if(!grid) return;
      grid.innerHTML = '';
      const visible = (lastServeData || []).filter(i => i.enabled !== false);
      visible.forEach(item => {
        const card = document.createElement('div');
        card.className = 'serve-item';
        card.setAttribute('role','listitem');

        const header = document.createElement('div');
        header.style.display = 'flex';
        header.style.alignItems = 'center';
        header.style.gap = '10px';

        const badge = document.createElement('div');
        badge.className = 'serve-badge';
        badge.textContent = item.badgeText || item.title.split(' ')[0].slice(0,3).toUpperCase();
        header.appendChild(badge);

        const h = document.createElement('h3');
        h.textContent = item.title;
        header.appendChild(h);
        card.appendChild(header);

        if(Array.isArray(item.roles) && item.roles.length){
          const ul = document.createElement('ul');
          item.roles.forEach(r => {
            const li = document.createElement('li');
            li.textContent = r;
            ul.appendChild(li);
          });
          card.appendChild(ul);
        }

        const actionRow = document.createElement('div');
        actionRow.style.marginTop = '8px';
        const joinBtn = document.createElement('a');
        joinBtn.className = 'btn-ghost';
        joinBtn.href = 'connect.html#serve';
        joinBtn.textContent = 'I want to serve';
        actionRow.appendChild(joinBtn);
        card.appendChild(actionRow);

        grid.appendChild(card);
      });

      if(visible.length === 0){
        const note = document.createElement('div');
        note.className = 'small-muted';
        note.textContent = 'No serve opportunities are available right now.';
        grid.appendChild(note);
      }
    }

    // Public API: show/hide the whole section
    function setServeVisible(show){
      const sec = document.getElementById('serveCard');
      if(!sec) return;
      if(show){
        sec.removeAttribute('aria-hidden');
        sec.classList.remove('hidden');
        sec.setAttribute('data-enabled','true');
      } else {
        sec.setAttribute('aria-hidden','true');
        sec.classList.add('hidden');
        sec.setAttribute('data-enabled','false');
      }
    }

    // Optional: load data from JSON file instead of inline array
    async function loadServeDataFrom(url='/serve-data.json'){
      try{
        const res = await fetch(url, {cache:'no-store'});
        if(!res.ok) throw new Error('No serve-data.json');
        const json = await res.json();
        renderServeGrid(json.items || json);
      }catch(e){
        renderServeGrid(SERVE_DATA);
      }
    }

    // ---------- MOBILE REORDER: Serve card under Announcements on small screens ----------
    (function manageServeCardPlacement(){
      const serve = document.getElementById('serveCard');
      const rightCol = document.querySelector('.right-col');
      const leftCol = document.querySelector('.left-col');
      if(!serve || !rightCol || !leftCol) return;
      const originalParent = serve.parentElement;
      const originalNext = serve.nextElementSibling;

      function placeForMobile(){
        if (rightCol.nextElementSibling !== serve) {
          rightCol.parentNode.insertBefore(serve, rightCol.nextElementSibling);
        }
      }
      function restoreForDesktop(){
        if (originalParent && originalParent !== serve.parentElement) {
          if (originalNext) originalParent.insertBefore(serve, originalNext);
          else originalParent.appendChild(serve);
        }
      }
      function checkAndApply(){
        if (window.innerWidth <= 980) placeForMobile();
        else restoreForDesktop();
      }
      checkAndApply();
      window.addEventListener('resize', checkAndApply);
    })();

    // ---------- INIT ----------
    document.addEventListener('DOMContentLoaded', () => {
      if (window.feather && typeof feather.replace === 'function') feather.replace();
      createLangSwitcher();
      applyTranslations();
      loadAndRenderAnnouncements();
      wireAppLinks();
      // render serve grid (attempt to load external JSON first)
      loadServeDataFrom().catch(()=>renderServeGrid(SERVE_DATA));
      setInterval(loadAndRenderAnnouncements, 5 * 60 * 1000);
    });
  </script>
</body>
</html>

