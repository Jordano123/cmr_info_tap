<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Listen — CMR</title>
  <style>
    :root{ --accent:#2b6cb0; --muted:#6b7280; --card-bg:#ffffff; --page-bg:#f3f4f6; --max-width:1000px; --pad:20px; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; }
    html,body{ margin:0; padding:0; background:var(--page-bg); color:#111827; -webkit-font-smoothing:antialiased; }
    .wrap{ width:100%; max-width:var(--max-width); margin:0 auto; padding:var(--pad); box-sizing:border-box; }
    .card{ background:var(--card-bg); border-radius:12px; padding:18px; box-shadow:0 8px 30px rgba(15,23,42,0.06); border:1px solid rgba(15,23,42,0.04); margin-bottom:16px; }
    h1{ margin:0 0 8px 0; font-size:20px; }
    .meta{ color:var(--muted); font-size:13px; margin-bottom:10px; }
    .episode-grid{ display:grid; grid-template-columns: 1fr; gap:14px; }
    @media(min-width:760px){ .episode-grid{ grid-template-columns: repeat(2, 1fr); } }
    .episode-thumb{ width:100%; height:160px; object-fit:cover; border-radius:8px; background:#e6eef9; display:block; margin-bottom:10px; }
    .episode-title{ font-weight:700; margin:0 0 6px 0; }
    .episode-desc{ margin:0 0 10px 0; color:#111827; line-height:1.4; }
    .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn{ background:var(--accent); color:#fff; padding:8px 12px; border-radius:8px; text-decoration:none; font-weight:700; display:inline-flex; align-items:center; gap:8px; }
    .btn-ghost{ background:#fff; border:1px solid rgba(15,23,42,0.06); color:#111827; padding:8px 12px; border-radius:8px; text-decoration:none; }
    .hidden { display:none !important; }
    .note{ font-size:13px; color:var(--muted); margin-top:8px; }
    .lang-switcher { position:fixed; top:12px; right:12px; display:flex; gap:8px; z-index:9999; }
    .lang-btn { padding:8px 10px; border-radius:8px; border:1px solid rgba(15,23,42,0.06); background:#fff; cursor:pointer; font-weight:700; }
  </style>
</head>
<body>
  <div class="lang-switcher" id="langSwitcherListen"></div>

  <div class="wrap">
    <div class="card">
      <h1 id="listenHeading">Listen</h1>
      <div class="meta" id="listenIntro">Audio recordings and edited services</div>

      <!-- Default simple view -->
      <div id="simpleView">
        <div class="note" id="noEpisodes">No episodes available right now.</div>
      </div>

      <!--
        Rich player view (commented out). To enable: remove the surrounding comment markers and call loadEpisodesRich() on DOMContentLoaded.
        It renders episodes from /listen-data.json and shows play controls and download links.
      -->
      <!--
      <div id="richView" class="episode-grid" aria-live="polite"></div>

      <script>
        async function loadEpisodesRich(){
          try{
            const res = await fetch('/listen-data.json', { cache: 'no-store' });
            if(!res.ok) throw new Error('Data not found');
            const data = await res.json();
            const episodes = (data.episodes || []).filter(e => e.enabled);
            const container = document.getElementById('richView');
            container.innerHTML = '';
            if(episodes.length === 0){ document.getElementById('noEpisodes').classList.remove('hidden'); return; }
            document.getElementById('simpleView').style.display = 'none';
            episodes.forEach(ep => {
              const card = document.createElement('article'); card.className='card';
              if(ep.thumbnail){ const img = document.createElement('img'); img.className='episode-thumb'; img.src=ep.thumbnail; img.alt=ep.title || 'Episode thumbnail'; card.appendChild(img); }
              const title = document.createElement('h2'); title.className='episode-title'; title.textContent = ep.title || 'Untitled'; card.appendChild(title);
              if(ep.date){ const meta = document.createElement('div'); meta.className='meta'; meta.textContent = ep.date; card.appendChild(meta); }
              if(ep.description){ const desc = document.createElement('p'); desc.className='episode-desc'; desc.textContent = ep.description; card.appendChild(desc); }
              if(ep.file){
                const audio = document.createElement('audio'); audio.controls=true; audio.preload='metadata';
                const src = document.createElement('source'); src.src = ep.file; src.type='audio/mpeg'; audio.appendChild(src); card.appendChild(audio);
                const controls = document.createElement('div'); controls.className='controls';
                const download = document.createElement('a'); download.className='btn-ghost'; download.href = ep.file; download.download=''; download.textContent = (getSavedLang() === 'fr') ? 'Télécharger' : 'Download';
                controls.appendChild(download); card.appendChild(controls);
              } else {
                const note = document.createElement('div'); note.className='note'; note.textContent = 'Audio file not available.'; card.appendChild(note);
              }
              container.appendChild(card);
            });
          }catch(err){
            console.warn('Failed to load episodes', err);
            document.getElementById('noEpisodes').classList.remove('hidden');
          }
        }
      </script>
      -->

    </div>
  </div>

  <script>
    const T_LISTEN = {
      en: { listenHeading: "Listen", listenIntro: "Audio recordings and edited services", noEpisodes: "No episodes available right now." },
      fr: { listenHeading: "Écouter", listenIntro: "Enregistrements audio et services édités", noEpisodes: "Aucun épisode disponible pour le moment." }
    };

    function getSavedLang(){ return localStorage.getItem('cmr_lang') || 'en'; }
    function setSavedLang(lang){ localStorage.setItem('cmr_lang', lang); applyListenTranslations(); }

    function buildLangSwitcher(containerId='langSwitcherListen'){
      const container = document.getElementById(containerId);
      if(!container) return;
      container.innerHTML = '';
      const enBtn = document.createElement('button'); enBtn.className='lang-btn'; enBtn.textContent='EN'; enBtn.onclick = ()=>{ setSavedLang('en'); };
      const frBtn = document.createElement('button'); frBtn.className='lang-btn'; frBtn.textContent='FR'; frBtn.onclick = ()=>{ setSavedLang('fr'); };
      container.appendChild(enBtn); container.appendChild(frBtn);
    }

    function applyListenTranslations(){
      const lang = getSavedLang();
      const t = T_LISTEN[lang] || T_LISTEN.en;
      document.getElementById('listenHeading').textContent = t.listenHeading;
      document.getElementById('listenIntro').textContent = t.listenIntro;
      document.getElementById('noEpisodes').textContent = t.noEpisodes;
    }

    document.addEventListener('DOMContentLoaded', () => { buildLangSwitcher(); applyListenTranslations(); });
  </script>
</body>
</html>
